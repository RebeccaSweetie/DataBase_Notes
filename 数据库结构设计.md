# 数据库结构设计

标签（空格分隔）： 数据库

---

**生命周期模型第三步数之数据库设计部份**

## 一、 数据库概念设计（面向现实世界）

- 解决数据需求
- 任务：
    - 说明数据范围
    - 获取信息模型
    - 说明数据属性特征
    - 说明数据间关系
    - 说明数据约束
    - 说明数据安全性要求
    - 支持各种数据处理需求
    - 保证信息模型可方便转换成数据库逻辑结构（**数据库模式**）
- 依据：需求分析阶段的文档（需求说明书、功能模型、各类报表等）

### 1.概念设计过程

#### （1）明确建模目标
#### （2）定义实体集

- 自底向上，逐步整合（与需求分析过程相反）
- 先画子系统ER图，系统总体信息模型为各子系统ER图整合
- 两种方法：
    - 分类标识、概括：先给每个类命名，再给每个实体集命名
        - 类型：顾客
        - 每个实体集：顾客编号、顾客姓名、顾客性别
    - 分类表述名词：关键是区分实体集名词和非实体集名词，有下面三个特征的词才能作为实体集名词：
        - 能够被描述和说明
        - 具有多个同类的实例
        - 每个实例可被标识和区分

#### （3）定义联系：描述实体集之间的关联关系

例如：“收银台”和“销售单据”两个实体集为收费关系，是1:n的连接关系

- 过程：
    - 标识联系：建立联系矩阵
        - 所有实体集沿水平、垂直两个方向列出，有联系打✖，没联系用空格
        - 只标注直接联系，不标注间接联系
    - 定义联系：
        - 定义**联系基数**，例如“供应商”、“商品”、“采购入库单据”之间为m：n：p，为不确定联系
    - 命名联系
        - 用动词/动词短语
        - 命名规则：自顶向下，从左到右

#### （4）建立信息模型
- 建模方法：ER
- 先建立局部信息模型，再合成总体信息模型

#### （5）确定实体集属性

可画在模型图中，也可列实体集-属性列表

#### （6）对信息模型进行集成与优化

### 2.数据建模方法

#### （1）ER建模方法

Entity Relationship 实体联系方法

- 概念
    - 实体Instance：客观存在，可相互区分
    - 实体集：属性特征相同的实体集合
    - 属性：一组属性描述一个实体集
        - 域：每个属性的取值范围
        - 属性值：实体的属性的具体取值
    - 码：能唯一标识每个实例的属性或属性组（如学号是学生的码，姓名不是，因为有重名）
    - 联系：实体间的联系，分为3类
        - 1:1一对一联系：丈夫-妻子
        - 1:n一对多联系：妈妈-儿子
        - m:n多对多联系：学生-课程
- 元素：
    - 实体集：矩形框
    - 联系：菱形框
    - 属性：椭圆或圆角框

#### （2）IDEF1X建模方法

- 同系列：IDEF0 功能建模方法
    IDFEF1X 数据建模方法
- 元素：
    - 实体集：
        - 独立实体集：实体集的码不依赖与其他实体集的联系，用矩形框
        - 从属实体集：实体集的码以来与其他实体集的联系，用圆角框
        - 框上方：名字/编码
        - 框内顶端：主码属性（PK）
        - 框内下部：外码属性（FK）和其他属性
        - 主码与其他属性用水平线分开
    - 联系：确定�型连接联系（1:n）
        - 标定型联系：子女实体集（从属）的每个实例由它与双亲（独立）的联系确定
            用从父端到子端的实线表示，终点处一个实心原点表示联系基数为n
        - 非标定型联系：两端都为独立实体集
            用从父端到子端的虚线表示，终点处一个实心原点表示联系基数为n
        - 分类联系：人类叫一般实体集（独立），男人和女人是两个分类实体集（从属）
            一般实体集和分类实体集对应同一事物，具有相同的码
            用实心圆点加两条水平实线段表示分类
        - 非确定联系：就是m:n多对多联系，两端都为独立实体集
            用在建模初始阶段，作用相当于虚拟函数，最终模型不能有非确定联系
            两个实体集间的实线，两端都有实心圆点

## 二、数据库逻辑设计（面向机器世界）

把ER模型转换为DBMS支持的数据模型

- 依据：
    - 概念模型
    - 数据处理要求
    - 数据约束及安全性要求
    - DBMS的相关信息
- 阶段目标：
    - DBMS可处理的模式
    - 数据库物理设计指南

- 设计过程
    - 初始模式设计
        两步：1.标识联系 2.依次转换成关系
        P45例子
- 命名确认
- 优化关系模式

## 三、数据库物理设计

- 数据库物理结构：
    - 数据库中数据以文件形式存储在外设存储介质（如磁盘）上
    - 逻辑记录：数据按逻辑分成序列，几个序列组成文件
    - 物理文件：一个文件占的一个磁盘块
    - DBMS：用于管理逻辑记录与磁盘块间的映射关系
    
- 数据库物理结构要解决的问题：
    - 文件的组织：数据映射映射到逻辑记录
    - 文件的结构：逻辑记录映射到磁盘块
    - 文件的存取：根据文件结构选择文件存取方法
    - 索引技术：提高存取速度

### 1.索引

快速数据访问技术

- 索引：记录域取值到物理地址的映射关系
- “记录域取值——物理地址”=“拼音——汉字”=“部首笔画——汉字”
- 代价：
    - 索引会占用一定存储空间
    - 数据更改时要同时维护索引
- 分类：
    - 有序索引技术/索引文件机制 “查找码（记录域）——物理地址”
        - 用索引文件实现映射
        - 索引文件由索引记录组成，每个记录记载一个索引项
        - 索引项=查找码值+对应文件记录的物理地址
    - 散列技术/哈希索引机制 
        - 用散列函数实现映射 “查找码（记录域）——物理地址”
        - 查找码=散列函数的散列域/排序域
        - 散列函数：输入查找码，输出物理地址

#### 有序索引

- 两个主体：数据文件（被索引文件、主文件）、索引文件
    一个数据文件可对应多个索引文件
- 索引文件的建立：
    - 选择一个或几个记录域作为查找码
    - 查找码取值与物理地址的映射关系组成索引项
    - 所有索引项根据某个查找码升序/降序排列，组成索引文件
    
- 有序索引分类：
    - 聚集索引和非聚集索引：将数据文件和索引文件均排列成顺序文件
        - 聚集索引：顺序一样
        - 非聚集索引：顺序不一样
        - 一个数据文件可建立一个聚集索引和多个非聚集索引
        - 索引顺序文件：聚集索引对应度数据文件，可进行两种访问：
            1.顺序访问：从数据文件里按顺序找那项数据
            2.直接访问：根据索引文件记录的物理地址直接访问数据文件里的那项数据
    - 稠密索引和稀疏索引：
        - 稠密索引：查找码和索引记录集合相等
        - 稀疏索引：索引记录是查找码的子集
        - 稀疏顺序索引查找时要从前一个查找码对应的地址开始才能把这个查找码对应的数据项找全
    - 主索引和辅索引
        - 主索引：查找码是主码属性
        - 辅索引：查找码是非主属性

    **实际的关系数据库系统的索引文件通常是主索引、聚集索引**
    - 唯一索引
        确保索引列不包含重复的值，多列唯一索引确保索引列中每个值的组合都是唯一的
    - 单层索引和多层索引
        - 多层索引：“外层索引——内层索引（索引块）——数据”=“部首——笔画——汉字”
        - 大数据量文件用多层树型索引，如B树和B+树